# FF14 Tools Portal

FF14での各種コンテンツにおける効率的なプレイと金策をサポートするための統合ツールポータルです。
最新のマーケット価格（Universalis API連携）や各種スケジュールを統合し、最適な金策手段をリアルタイムで提案・計算します。

---

## 🌟 主な機能・ツール

### 1. Cosmo Explorer Dashboard (コスモエクスプローラー・ダッシュボード)
コスモエクスプローラーにおける金策とタスク管理を効率化するための機能群です。
- **天候EX+ 発生予報**: テンペスト（オイジュス）や東ザナラーン（パエンナ）などの特定の環境条件（天候・時間）が、今後いつ発生するかをET（エオルゼア時間）ベースで予測表示させます。
- **動的レコメンド機能**: 最新のマーケット価格（Universalis）と販売履歴（1日の流通数）を自動算出し、今最も「交換・販売」効率が良いアイテムとミッションを特定・提案します。
- **オイジュス・エネルギーパック鑑定計算**: そのまま出品すべきか、開封してレアアイテムを狙うべきかを、市場価格からの期待値（EV）と「鑑定時間による時給ロス」を考慮して判定・推奨します。
- **レア・高額アイテム監視**: ダッシュボード内で常に高額ミニオンやマウントのJP最安値をトラッキング。APIの502エラーやタイムアウトに対しても再試行（リトライバックオフ）処理を内包し、常に安定した価格表示を提供します。

### 2. Crafted Gear Price Tracker (新式装備相場・自作原価計算機)
最新の製作装備（コートリーラヴァー一式等）の相場と自作メリットを計算するツールです。
- **最新相場の自動取得**: 全装備のマケボ最安値（Mana）を一覧表示します。
- **自作原価の再帰的計算**: Teamcraftのレシピデータを解釈し、各装備を作るのに必要な「末端素材（伝説/霊砂等）」を算出。その最安値をすべて掛け合わせた「自作した場合の合計原価」を表示します。
- **時給換算機能**: マクロ1周あたり90秒と仮定し、全工程にかかる時間と利益率から「現在の全体平均の稼ぎ（gil/1時間）」を表示します。装備をクリックすると、必要素材の内訳と小計も確認可能です。

### 3. Grand Company & Levequests (グラカン納品・リーヴ納品支援ツール)
日々のグランドカンパニー納品とギルドリーヴ納品の金策・経験値効率をサポートするツール群です。
- **グラカン納品（Lv1~100）完全網羅**: クラフター・ギャザラー全11クラスのレベルごとの要求アイテムを抽出。「10レベル区切りのサイドバーナビ」を使って、指定のレベル帯へスムーズにジャンプできます。
- **完成品と素材原価の差額抽出**: 指定アイテムの最安値(HQ)と、それを一から製作した場合の「全素材の時価合計」を比較したアコーディオンパネルを自動生成。「自分で作ったほうが安いか、マケボで買ったほうが安い（または完成品を売ることで利益が出る）か」を一瞬で判断できます。
- **完全な一列レイアウト**: 情報量が多くなりがちな相場と素材情報をスッキリ見せるため、スマホやPCでも見やすい1カラム（縦一列）の洗練されたUIに統一しました。

---

## 🚀 ローカルでのセットアップと実行方法

### 必須環境
- Python 3.10 以上
- 以下のPythonライブラリが必要です：
  ```bash
  pip install EorzeaEnv
  ```

### 実行手順
1. 本リポジトリを適当なフォルダにダウンロード（クローン）します。
2. ターミナル（Powershellやコマンドプロンプト）を開きます。
3. **サーバー機能群の起動**
   ```bash
   cd cosmo_dashboard
   python weather_fetcher.py
   ```
   
4. **ブラウザでのアクセス**
   - **メインポータル画面**: `http://localhost:8000/portal/index.html` (ここから全てのツールへ飛べます)
   - **コスモ_ダッシュボード**: `http://localhost:8000`
   - **グラカン納品相場表**: `http://localhost:8000/levequests/gc_supply.html`
   - **新式相場表**: `http://localhost:8000/craft`

---

## 📊 技術仕様・API制約設計

- **主なデータソース**: 
  - Universalis API v2 (マーケット価格取得/履歴追跡)
  - FFXIV Teamcraft レシピデータ (アイテムの素材構成逆算/日本語ローカライズ)
  - EorzeaEnv (エオルゼア天候・時間計算)
- **API負荷・BAN対策**: APIへの秒間リクエスト制限や一括リクエスト（バルク取得）を考慮した設計になっています。短期間に大量のリクエストを送信して制限を受けないよう、適切なスリープ（待機時間）処理を入れています。また、エラーに対するフェイルセーフなリトライロジックも組み込まれています。

---

## ⚠️ 免責事項

- 本ツールは個人利用を目的としています。
- Web公開やレンタルサーバー等へのアップロードを検討する場合は、UniversalisのAPI利用ガイドライン（Rate Limit）やスクウェア・エニックスの著作物利用許諾条件に抵触しないよう、自己責任において非同期処理（cron等）の設計に変更してください。
- 計算モデルの推定値（時給や期待値）と実際のゲーム内での結果が異なる場合があります。最終的な判断はゲーム内の相場やご自身の環境を確認した上で行ってください。

(C) SQUARE ENIX CO., LTD. All Rights Reserved.
