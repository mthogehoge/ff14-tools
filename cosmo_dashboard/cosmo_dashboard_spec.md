# コスモエクスプローラー・ダッシュボード（FF14天候EX+予報）仕様書

本ドキュメントでは、現在動作している「コスモエクスプローラー・ダッシュボード」の全機能仕様、計算ロジック、および内部スケジュールについて解説します。

---

## 1. 画面構成の全体像

ダッシュボードは大きく以下の4つのセクションから構成されています。

1. **ヘッダー＆エオルゼア時間（ET）表示**
2. **おすすめの稼ぎタスク（優先度付きのアラート）**
3. **ミッションスケジュールボード（各エリアのタイムテーブル）**
4. **天候リスト（直近の空模様予報）**

---

## 2. 推奨タスク（おすすめの稼ぎタスク）判定ロジック

ダッシュボードの最上部に表示される「おすすめの稼ぎタスク」は、リアルタイムの**エオルゼア時間（ET）**と**現在の天候**、および**Universalisの現在マケボ価格相場**を元に、最も「時給（期待値）」が高いタスクを動的に計算して提案します。

### (A) メカオペレーション（F.A.T.E.枠）の優先告知
メカオペレーションは**リアルタイム（LT）で毎時20分、40分、00分**に確定で発生します。
- **直前（5分前以内）およびプレイ中**：【最優先】として「ただいまメカオペが開催中/開催直前です！参加を最優先しましょう」と強烈にアラートを出します。
- **それ以外の時間**：【準備】として「次のメカオペは〇〇分後です。クレジットを1000個集めましょう」と告知します。
- **期待値（ギル）**：メカオペ1回クリアにつき1800コスモクレジットが手に入るため、`1800 × 最新のコスモクレジット金策単価` としてギル換算期待値を表示します。

### (B) ミッション評価額の算定（EV : Expected Value）計算式
各採集・製作ミッションの「1周回分（約2~3分）」で得られる報酬の合計額を計算し、最も高いものを抽出しおすすめとして表示します。

- **1コスモクレジットあたりの相場**
  「コスモクレジットで交換できる全素材」のUniversalis相場を自動取得し、最も「ギルに変えやすい（かつ売行きの良い）」アイテムの価格から「1クレジット＝約〇〇ギル」の基準値を定めます。
- **ローカルクレジット（各星の固有通貨）**
  コスモクレジットの **1.8倍** の価値として換算します（エリア交換品のレートに基づく）。
- **ギャザラーEX+の超精密期待値（実測ベース）**
  実際にユーザーが1500GPを消費してミッションを行う際の「ダブルボーナス（8個獲得）」の発生率、および「ゴールドスター達成時の報酬増加率（平均1.1333倍）」を加味した**1周回あたりの超高精度な実質獲得数**をハードコードしています。
  *例：オイジュス採掘/園芸の場合、1回で コスモ(141)、オイジュス(129)、手形(200で証書1枚)、ドローンチップ(200でパック1個) が平均して手に入ると見なし、それぞれの現在マケボ価格を合算して期待値（ギル）を出します。*
- **クラフターEX+の期待値**
  クラフターに関してもログから算出された1ミッションあたりの着地最大値（コスモ325, ローカル215など）を基準に計算します。

---

## 3. 各エリアの天候EX+ 発生条件

特定の天候になると、スケジュール表（時間割り）には存在しない**「天候限定のEX+ミッション（ギャザラー・クラフター）」**が例外的に発生します。

| エリア名 | 対象天候（ゲーム内表記） | ダッシュボード表示内容 |
| :--- | :--- | :--- |
| **テンペスト（オイジュス）** | `快晴`、`曇り` | 快晴 / 曇り |
| **東ザナラーン（パエンナ）** | `雨`、`暴雨`、`霧`、`曇り` | 雨 / 曇り |
| **ウルティマ・トゥーレ（焦がれの入り江）** | `雷霊風`、`月砂塵` | 雷霊風 / 月砂塵 |

※現在の天候がこれらに一致している間は、おすすめ欄の最上位に「天候EX+が発生中！」として強力にプッシュされます。

---

## 4. 時間限定ミッション スケジュール表（MISSION_DATA）

ダッシュボード中段に表示されるスケジュールボードは、各エリアごとに以下のエオルゼア時間（ET）のスケジュールでローテーションされています。

**※「天候EX+」はこの表には載らず、天候条件を満たした場合のみ隠しミッションとして発現します。**

### オイジュス（テンペスト）
- ET 00:00～03:59：EX+: 甲冑師
- ET 04:00～07:59：EX+: 彫金師、EX+: 漁師
- ET 08:00～11:59：EX+: 革細工師、EX+: 採掘師
- ET 12:00～15:59：EX+: 裁縫師、EX+: 採掘師
- ET 16:00～19:59：EX+: 木工師、EX+: 錬金術師
- ET 20:00～23:59：EX+: 鍛冶師、EX+: 調理師、EX+: 園芸師

### パエンナ（東ザナラーン）
- ET 00:00～01:59：A1: 木工師、A1: 錬金術師
- ET 00:00～03:59：EX+: 甲冑師
- ET 02:00～03:59：A1: 採掘師
- ET 04:00～05:59：A1: 鍛冶師、A1: 調理師
- ET 04:00～07:59：EX+: 彫金師、EX+: 漁師
- ET 08:00～09:59：A1: 甲冑師、A1: 漁師
- ET 08:00～11:59：EX+: 革細工師
- ET 10:00～11:59：A1: 園芸師
- ET 12:00～13:59：A1: 彫金師
- ET 12:00～15:59：EX+: 裁縫師、EX+: 採掘師
- ET 16:00～17:59：A1: 革細工師
- ET 16:00～19:59：EX+: 木工師、EX+: 錬金術師
- ET 20:00～21:59：A1: 裁縫師
- ET 20:00～23:59：EX+: 鍛冶師、EX+: 調理師、EX+: 園芸師

### ウルティマ・トゥーレ（焦がれの入り江）
- ET 00:00～01:59：A1: 木工師、A1: 錬金術師、A3: 彫金師
- ET 00:00～03:59：EX+: 木工師、EX+: 漁師
- ET 02:00～03:59：A1: 採掘師
- ET 04:00～05:59：A1: 鍛冶師、A1: 調理師、A3: 革細工師
- ET 04:00～07:59：EX+: 鍛冶師、Aランク: 裁縫師
- ET 06:00～07:59：A1: 漁師
- ET 08:00～09:59：A1: 甲冑師、A3: 裁縫師
- ET 08:00～11:59：EX+: 甲冑師、EX+: 採掘師
- ET 10:00～11:59：A1: 園芸師
- ET 12:00～13:59：A1: 彫金師、A3: 木工師、A3: 錬金術師
- ET 12:00～15:59：EX+: 彫金師、Aランク: 甲冑師
- ET 14:00～15:59：A3: 採掘師
- ET 16:00～17:59：A1: 革細工師、A3: 鍛冶師、A3: 調理師
- ET 16:00～19:59：EX+: 革細工師、EX+: 園芸師
- ET 20:00～21:59：A1: 裁縫師、A3: 甲冑師
- ET 20:00～23:59：EX+: 裁縫師、Aランク: 漁師
- ET 22:00～23:59：A3: 園芸師

---

## 5. バックエンドの動作要件 (Python)
- **定期更新スクリプト:** `weather_fetcher.py` 内部に簡易HTTPサーバーを内蔵しており、`localhost:8000` で常に最新のUIを提供します。
- **データ取得間隔:** サーバーサイドでFF14内の現在時刻を0.1秒単位で監視し、Universalisの相場は定期的に自動キャッシュ（2時間ごと）します。これにより常に最新の「ギルへの換金効率」が算定された上でダッシュボードが生成されます。
